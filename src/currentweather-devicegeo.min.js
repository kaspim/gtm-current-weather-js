var apikey = 'KEY'; // Your API key from https://openweathermap.org
var expire = 60;    // Time to store weather information in minutes

!function(t,e,n){function a(t,e,n){var a=new XMLHttpRequest;a.onreadystatechange=function(){a.readyState===XMLHttpRequest.DONE&&(200===a.status?e&&e(JSON.parse(a.responseText)):n&&n(a))},a.open('GET',t,!0),a.send()}function o(t,e,n,a){window.dataLayer=window.dataLayer||[],dataLayer.push({event:'weather',weather:{station:t,main:e,decription:n,temperature:a}})}function i(i,r){a('https://api.openweathermap.org/data/2.5/find?lat='+i+'&lon='+r+'&cnt=1&units='+e+'&appid='+t,function(t){!function(t){var e=t.list[0].name,a=t.list[0].weather[0].main,i=t.list[0].weather[0].description,r=Math.round(t.list[0].main.temp);o(e,a,i,r);var c=new Date;c.setTime(c.getTime()+6e4*n),document.cookie='gtm.weather.station='+e+'; expires='+c.toGMTString()+'; path=/',document.cookie='gtm.weather.main='+a+'; expires='+c.toGMTString()+'; path=/',document.cookie='gtm.weather.detail='+i+'; expires='+c.toGMTString()+'; path=/',document.cookie='gtm.weather.temperature='+r+'; expires='+c.toGMTString()+'; path=/'}(t)})}function r(){a('https://apps.martinkaspar.net/api/geo/',function(t){i(t.ipgeo.latitude,t.ipgeo.longtitude)})}if(navigator.cookieEnabled){var c=(document.cookie.match(/^(?:.*;)?\s*gtm.weather.station=\s*([^;]+)(?:.*)?$/)||[,null])[1],u=(document.cookie.match(/^(?:.*;)?\s*gtm.weather.main=\s*([^;]+)(?:.*)?$/)||[,null])[1],s=(document.cookie.match(/^(?:.*;)?\s*gtm.weather.detail=\s*([^;]+)(?:.*)?$/)||[,null])[1],m=(document.cookie.match(/^(?:.*;)?\s*gtm.weather.temperature=\s*([^;]+)(?:.*)?$/)||[,null])[1];null!==c&&null!==u&&null!==s&&null!==m?o(c,u,s,m):navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){i(t.coords.latitude,t.coords.longitude)},function(){r()}):r()}}(apikey,'metric',expire);
